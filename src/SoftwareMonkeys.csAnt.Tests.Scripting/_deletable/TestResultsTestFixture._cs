using System;
using NUnit.Framework;
using System.IO;

namespace SoftwareMonkeys.csAnt.Tests.Scripting
{
    [TestFixture]
    public class TestResultsFixture : BaseScriptingTestFixture
    {
        [Test]
        public void Test_SimpleScript_CheckHtmlTestResults()
        {
            var script = GetDummyScript();

            script.FilesGrabber.GrabOriginalScriptingFiles();

            var helloWorldScript = script.ActivateScript<ITestScript>("Test_HelloWorld");

            helloWorldScript.Start();

            Assert.IsFalse(helloWorldScript.IsError);

            var htmlResultsDir = new HtmlResultFileNamer().GetResultsDirectory(script);

            Assert.AreEqual(2, Directory.GetFiles(htmlResultsDir).Length);
        }


        /// <summary>
        /// Executes a test script that launches another test script within it.
        /// </summary>
        [Test]
        public void Test_TestWithinTest_CheckHtmlTestResults()
        {
            var script = GetDummyScript();

            script.FilesGrabber.GrabOriginalFiles();

            var helloWorldScript = script.ActivateScript<ITestScript>("Test_TestHelloWorldFromCopy");

            helloWorldScript.Start();

            Assert.IsFalse(helloWorldScript.IsError);

            var htmlResultsDir = new HtmlResultFileNamer().GetResultsDirectory(script);

            Console.WriteLine(htmlResultsDir);

            Assert.AreEqual(2, Directory.GetFiles(htmlResultsDir).Length);
            
            Assert.AreEqual(1, Directory.GetDirectories(htmlResultsDir).Length);

            var subDir = Directory.GetDirectories(htmlResultsDir)[0];
            
            Assert.AreEqual(2, Directory.GetFiles(subDir).Length);
        }
    }
}

